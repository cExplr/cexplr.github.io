<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>AllesCTF 2020 - Service Revolution - cExplr&#x27;s Blog</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../../favicon.svg">
        
        
        <link rel="shortcut icon" href="../../favicon.png">
        
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../0_home.html">Home</a></li><li class="chapter-item expanded affix "><a href="../../research/1_ASUSWRT_3_0_0_4_384_20308.html">ASUSWRT URL Processing Stack Buffer Overflow</a></li><li class="chapter-item expanded affix "><a href="../../writeups/service_revolution/2_AllesCTF_service_revolution.html" class="active">AllesCTF 2020 - Service Revolution</a></li><li class="chapter-item expanded affix "><a href="../../writeups/angr/3_angr_post_1.html">Angr-CTF #1 - Basic Concepts, Find and Avoid</a></li><li class="chapter-item expanded affix "><a href="../../writeups/angr/4_angr_post_2.html">Angr-CTF #2 - Find Conditions, Symbolic Registers and Stack</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">cExplr&#x27;s Blog</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#rev-flag-service-revolution" id="rev-flag-service-revolution">[Rev] Flag Service Revolution</a></h1>
<h4><a class="header" href="#7-september-2020" id="7-september-2020">7 September 2020</a></h4>
<hr />
<h5><a class="header" href="#team--hats-singapore" id="team--hats-singapore">Team : HATS Singapore</a></h5>
<h5><a class="header" href="#challenge-files--a-hrefbootdolbootdola" id="challenge-files--a-hrefbootdolbootdola">Challenge File[s] : <a href=".//boot.dol">boot.dol</a></a></h5>
<h3><a class="header" href="#description" id="description">Description</a></h3>
<pre><code>Flag Service Revolution
Category: Reverse Engineering
Difficulty: Medium
Author: TheVamp, 0x4d5a
First Blood: LSE

Welcome to our great Flag{Service_Revolution}

Challenge Files:flag_service_revolution.7z
Feedback: Did you like the challenge? Thoughts? Give feedback here
</code></pre>
<h2><a class="header" href="#what-the-file" id="what-the-file">What The File?</a></h2>
<p>In this file, we are presented with mainly the boot.dol file. After a quick search on Google, we found <a href="https://www.file-extensions.org/dol-file-extension">this</a> link.</p>
<blockquote>
<p>DOL file extension - Nintendo GameCube executable.</p>
</blockquote>
<p>It also says that we can use <code>Dolphin</code> to work with *.dol files. </p>
<h2><a class="header" href="#dolphin-emulator" id="dolphin-emulator">DOLphin Emulator</a></h2>
<p>We then download the Dolphin emulator version 5 from <a href="https://dolphin-emu.org/download/">https://dolphin-emu.org/download/</a>. Next, click on File -&gt; Open... and select the <code>boot.dol</code> file.</p>
<p><img src="img/dolphin-emu-rundol.png" alt="rickrolling" /></p>
<p>Also, click on the <code>Controllers</code> icon. Make sure that the Wii Remote 1 is an <code>Emulated Wii Remote</code>. Click on configure to choose the choice of device, buttons and D-Pad. Once that is done, we can test our key input with the loaded game.</p>
<p><img src="img/checkkeypress.png" alt="keypressed" /></p>
<p>Note that there is also debugger built into the Dolphin Emulator though it is not really necessary.</p>
<h2><a class="header" href="#converting-the-dol-file-to-elf" id="converting-the-dol-file-to-elf">Converting the Dol file to ELF</a></h2>
<p>Throwing the dol file straight into Ghidra did not work. After a search <code>dol file in ghidra</code>, the first result points us to this <a href="https://hmapl.wordpress.com/2019/04/13/ghidra-a-potentially-useful-reverse-engineering-tool/">link</a>.</p>
<blockquote>
<p>Gamecube executables are typically in a DOL format. While this can, in theory be analyzed, it�s much easier for Ghidra (and other tools) to analyze an ELF-format file.</p>
</blockquote>
<p>To do this, we can use a tool aptly called <a href="https://www.gc-forever.com/forums/viewtopic.php?t=17#p19">DolTool</a>. We will need to download the DolTool x0.3 - TenOfTen(LINUX) and compile it ourselves. Thankfully all it takes is <code>g++ -o ./doltool *cpp</code> and it should be compiled in no time. </p>
<p>Next run the following command.</p>
<pre><code>$ ./doltool -e boot.dol
DolTool v0.3 - loser 2003

Converted boot.dol to to boot.elf

$ file boot.elf 
boot.elf: ELF 32-bit MSB executable, PowerPC or cisco 4500, version 1 (SYSV), statically linked, stripped
</code></pre>
<p>This ELF should be recognizable by Ghidra.</p>
<h2><a class="header" href="#ghidraing-bootelf" id="ghidraing-bootelf">Ghidra'ing boot.elf</a></h2>
<p>The approach here is to do a strings to look for the <code>No flag yet...</code>. One of the functions referencing this string is <code>FUN_8003d4c4(void)</code>. </p>
<p>The decompilation is as follows</p>
<pre><code class="language-c">void FUN_8003d4c4(void)

{
...
&lt;REDACTED&gt;
...
  local_44 = DAT_803900a8;
  local_54 = s_Great_803900a0._4_2_;
  local_50 = DAT_803900ac;
  local_74 = s_{Service_Revolution}!_803900b4._4_4_;
  local_70 = s_{Service_Revolution}!_803900b4._8_4_;
  local_42 = DAT_803900aa;
  local_4c = DAT_803900b0;
  local_58 = s_Great_803900a0._0_4_;
  local_78 = s_{Service_Revolution}!_803900b4._0_4_;
  local_6c = s_{Service_Revolution}!_803900b4._12_4_;
  local_68 = s_{Service_Revolution}!_803900b4._16_4_;
  local_64 = s_{Service_Revolution}!_803900b4._20_2_;
  local_60 = s_Welcome_80390098._0_4_;
  local_5c = s_Welcome_80390098._4_4_;
  local_48 = 0x6f757200;
  local_120 = s_No_buttons_pressed_yet_..._800a7fc0._12_4_;
  local_11c = s_No_buttons_pressed_yet_..._800a7fc0._16_4_;
  local_118 = s_No_buttons_pressed_yet_..._800a7fc0._20_4_;
  local_114 = s_No_buttons_pressed_yet_..._800a7fc0._24_2_;
  local_112 = s_No_buttons_pressed_yet_..._800a7fc0[26];
  no_flag_yet_Str = s_No_flag_yet_..._800a7ff4._0_4_;
  local_de = 0x111;
  string_key_pressed = s_No_buttons_pressed_yet_..._800a7fc0._0_4_;
  local_128 = s_No_buttons_pressed_yet_..._800a7fc0._4_4_;
  local_124 = s_No_buttons_pressed_yet_..._800a7fc0._8_4_;
  local_15c = s_No_flag_yet_..._800a7ff4._4_4_;
  local_158 = s_No_flag_yet_..._800a7ff4._8_4_;
  local_154 = s_No_flag_yet_..._800a7ff4._12_4_;
  local_fb = 0;
  local_111 = 0;
  local_10d = 0;
  local_109 = 0;
  local_105 = 0;
  local_101 = 0;
  local_fd = 0;
  FUN_800971b4(auStack336,0,0x22);
  sequence = FUN_8003ebc4(auStack200,auStack404,PNG_801aa8e0,300,200);
  if (sequence == 0) {
    return;
  }
  iVar3 = 0xf;
  FLAG = &amp;no_flag_yet_Str;
  sequence = 0;
  FUN_80040594(auStack404,0x4c,0x3e);
  iVar2 = 0;
  iVar4 = 0x14;
  FUN_800406e4((double)DAT_803900cc,auStack404);
  local_16a = 0;
  FUN_8003eb1c();
  do {
    iVar1 = FUN_8003eb74();
    if (iVar1 == 0) {
      FUN_8003eba0(&amp;DAT_801d8f20,0x1b70d8);
    }
                    /* doesnt enter here
                        */
    if (DAT_8044b998 != 0) {
      FUN_8003eb54();
      FUN_80041db0(auStack200);
      FUN_80040458();
    }
    FUN_800568f4();
    if (DAT_8044b958 == 0) {
                    /* enters here
                        */
      iVar4 = iVar4 + ((uint)(DAT_8044b954 == 0) - 1);
      if (DAT_8044b950 == 0) goto LAB_8003d84c;
LAB_8003d74c:
      iVar3 = iVar3 + 1;
    }
    else {
      iVar4 = iVar4 + 1;
      if (DAT_8044b950 != 0) goto LAB_8003d74c;
LAB_8003d84c:
                    /* comes here */
      iVar3 = iVar3 + ((uint)(DAT_8044b94c == 0) - 1);
    }
    FUN_800993ec(auStack504,s_%s_%s_%s_%s_%s%s_80390084,&amp;local_60,&amp;local_44,&amp;local_48,&amp;local_58,
                 &amp;local_50,&amp;local_78);
    FUN_80040fd8(displayString,iVar4,iVar3,auStack504);
    key_code = get_keypress_FUN_800569b0(0);
    if (key_code != 0) {
      keypress_Strings_FUN_8003d2d4(key_code,(char *)&amp;string_key_pressed);
      if (sequence == 9) {
        if ((key_code &amp; 0x800) != 0) {
          FLAG = (undefined4 *)&amp;local_a0;
          local_8e = local_5c._2_1_;
          local_90 = local_6c._0_1_;
        }
LAB_8003d8e4:
        if (sequence == 0) {
LAB_8003d8ec:
          sequence = 0;
          if ((key_code &amp; 8) != 0) {
            sequence = 1;
            local_80 = (char)local_58;
            local_7e = local_78._1_1_ + ' ';
            local_81 = local_60._2_1_;
            local_a0 = (char)local_58 + -0x20;
            local_83 = local_70._0_1_;
          }
        }
      }
      else {
        if (sequence == 8) {
          if ((key_code &amp; 0x800) == 0) goto LAB_8003d8ec;
          local_93 = local_58._2_1_;
          sequence = 9;
          local_98 = local_68._0_1_;
        }
        else {
          if (sequence == 7) {
            if ((key_code &amp; 0x400) == 0) goto LAB_8003d8ec;
            sequence = 8;
            local_85 = (char)local_58;
            local_82 = local_50._0_1_ + ' ';
            local_92 = local_70._0_1_;
            local_8d = local_68._2_1_;
          }
          else {
            if (sequence == 6) {
              if ((key_code &amp; 0x400) == 0) goto LAB_8003d8ec;
              sequence = 7;
              local_7d = (undefined)local_68;
              local_9f = local_50._1_1_ + -0x20;
              local_9c = local_78._1_1_;
              local_95 = (undefined)local_44;
            }
            else {
              if (sequence == 5) {
                if ((key_code &amp; 0x100) == 0) goto LAB_8003d8ec;
                sequence = 6;
                local_7f = (undefined)local_50;
                local_9d = (char)local_74 + -0x20;
                local_7c = 0;
                local_91 = local_54._0_1_;
              }
              else {
                if (sequence == 4) {
                  if ((key_code &amp; 0x200) == 0) goto LAB_8003d8ec;
                  sequence = 5;
                  local_96 = local_50._1_1_;
                  local_88 = local_58._0_1_ + ' ';
                  local_8b = local_60._1_1_;
                  local_97 = local_70._0_1_;
                }
                else {
                  if (sequence == 3) {
                    if ((key_code &amp; 0x100) == 0) goto LAB_8003d8ec;
                    local_8a = local_58._1_1_;
                    sequence = 4;
                    local_8f = local_70._0_1_;
                    local_9b = local_78._0_1_;
                    local_89 = local_8f;
                  }
                  else {
                    if (sequence == 2) {
                      if ((key_code &amp; 0x200) == 0) goto LAB_8003d8ec;
                      sequence = 3;
                      local_94 = (undefined)local_70;
                      local_87 = local_70._1_1_ + ' ';
                      local_86 = (char)local_74;
                      local_99 = local_74._1_1_;
                    }
                    else {
                      if (sequence != 1) goto LAB_8003d8e4;
                      if ((key_code &amp; 4) == 0) goto LAB_8003d8ec;
                      sequence = 2;
                      local_84 = local_44._0_1_;
                      local_9e = local_6c._1_1_ + -0x20;
                      local_8c = (undefined)local_6c;
                      local_9a = local_60._0_1_;
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
    iVar2 = iVar2 + 1;
    key_code = (uint)local_16a;
    if ((uint)(iVar2 * -0x33333333) &lt; 0x33333334) {
      key_code = key_code + 1 &amp; 0xffff;
      if (key_code == 0x1b) {
        key_code = 0;
        local_16a = 0;
      }
      else {
        local_16a = (ushort)key_code;
      }
    }
    FUN_80040630(auStack404,(int)local_18c,(int)local_18a,key_code);
    FUN_80040fd8(displayString,0xf,100,&amp;string_key_pressed);
    FUN_80040fd8(displayString,0xf,0x82,FLAG);
    FUN_80040270();
  } while( true );
}
</code></pre>
<p>What this essentially is doing is to store the strings that we see in the running program like <code>No buttons pressed yet ...</code> and <code>No flag yet ...</code>. These will be printed out onto the screen first. In the game loop, it would check for keypresses in which it would also return some sort of keycode based on the buttons pressed which will allow the right strings to be printed. </p>
<p>It detects keypressed based on bitmasking. In summary, these are the bitmasking for each of the buttons.</p>
<pre><code>BITMASK  =  KEY PRESS
0x8 = A press 
0x4 = B press 
0x800 = up press 
0x400 = down press
0x100 = left press 
0x200 = right press 
0x1000 = + press
0x10 = - press 
0x1 = 1 press 
0x2 = 2 press
</code></pre>
<details>
<summary>
Click here to see the decompilation of keypress_Strings_FUN_8003d2d4
</summary>
<pre><code class="language-c">void keypress_Strings_FUN_8003d2d4(uint key_code,char *pressed_key)

{
  undefined4 uVar1;
  undefined2 uVar2;
  char cVar3;
  undefined4 uVar4;
  
  uVar2 = s_UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU_8038ffbc._68_2_;
  uVar1 = s_UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU_8038ffbc._64_4_;
  if ((key_code &amp; 8) != 0) {
    *(undefined4 *)pressed_key = s_UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU_8038ffbc._60_4_;
    *(undefined4 *)(pressed_key + 4) = uVar1;
    *(undefined2 *)(pressed_key + 8) = uVar2;
  }
  uVar2 = s_Pressed_B_80390004._8_2_;
  uVar1 = s_Pressed_B_80390004._4_4_;
  if ((key_code &amp; 4) != 0) {
    *(undefined4 *)pressed_key = s_Pressed_B_80390004._0_4_;
    *(undefined4 *)(pressed_key + 4) = uVar1;
    *(undefined2 *)(pressed_key + 8) = uVar2;
  }
  cVar3 = s_Pressed_UP_80390010[10];
  uVar2 = s_Pressed_UP_80390010._8_2_;
  uVar1 = s_Pressed_UP_80390010._4_4_;
  if ((key_code &amp; 0x800) != 0) {
    *(undefined4 *)pressed_key = s_Pressed_UP_80390010._0_4_;
    *(undefined4 *)(pressed_key + 4) = uVar1;
    *(undefined2 *)(pressed_key + 8) = uVar2;
    pressed_key[10] = cVar3;
  }
  cVar3 = s_Pressed_DOWN_8039001c[12];
  uVar4 = s_Pressed_DOWN_8039001c._8_4_;
  uVar1 = s_Pressed_DOWN_8039001c._4_4_;
  if ((key_code &amp; 0x400) != 0) {
    *(undefined4 *)pressed_key = s_Pressed_DOWN_8039001c._0_4_;
    *(undefined4 *)(pressed_key + 4) = uVar1;
    *(undefined4 *)(pressed_key + 8) = uVar4;
    pressed_key[0xc] = cVar3;
  }
  cVar3 = s_Pressed_LEFT_8039002c[12];
  uVar4 = s_Pressed_LEFT_8039002c._8_4_;
  uVar1 = s_Pressed_LEFT_8039002c._4_4_;
  if ((key_code &amp; 0x100) != 0) {
    *(undefined4 *)pressed_key = s_Pressed_LEFT_8039002c._0_4_;
    *(undefined4 *)(pressed_key + 4) = uVar1;
    *(undefined4 *)(pressed_key + 8) = uVar4;
    pressed_key[0xc] = cVar3;
  }
  uVar2 = s_Pressed_RIGHT_8039003c._12_2_;
  uVar4 = s_Pressed_RIGHT_8039003c._8_4_;
  uVar1 = s_Pressed_RIGHT_8039003c._4_4_;
  if ((key_code &amp; 0x200) != 0) {
    *(undefined4 *)pressed_key = s_Pressed_RIGHT_8039003c._0_4_;
    *(undefined4 *)(pressed_key + 4) = uVar1;
    *(undefined4 *)(pressed_key + 8) = uVar4;
    *(undefined2 *)(pressed_key + 0xc) = uVar2;
  }
  cVar3 = s_Pressed_PLUS_8039004c[12];
  uVar4 = s_Pressed_PLUS_8039004c._8_4_;
  uVar1 = s_Pressed_PLUS_8039004c._4_4_;
  if ((key_code &amp; 0x1000) != 0) {
    *(undefined4 *)pressed_key = s_Pressed_PLUS_8039004c._0_4_;
    *(undefined4 *)(pressed_key + 4) = uVar1;
    *(undefined4 *)(pressed_key + 8) = uVar4;
    pressed_key[0xc] = cVar3;
  }
  uVar2 = s_Pressed_MINUS_8039005c._12_2_;
  uVar4 = s_Pressed_MINUS_8039005c._8_4_;
  uVar1 = s_Pressed_MINUS_8039005c._4_4_;
  if ((key_code &amp; 0x10) != 0) {
    *(undefined4 *)pressed_key = s_Pressed_MINUS_8039005c._0_4_;
    *(undefined4 *)(pressed_key + 4) = uVar1;
    *(undefined4 *)(pressed_key + 8) = uVar4;
    *(undefined2 *)(pressed_key + 0xc) = uVar2;
  }
  uVar2 = s_Pressed_1_8039006c._8_2_;
  uVar1 = s_Pressed_1_8039006c._4_4_;
  if ((key_code &amp; 2) == 0) {
    if ((key_code &amp; 1) == 0) {
      return;
    }
  }
  else {
    *(undefined4 *)pressed_key = s_Pressed_1_8039006c._0_4_;
    *(undefined2 *)(pressed_key + 8) = uVar2;
    *(undefined4 *)(pressed_key + 4) = uVar1;
    if ((key_code &amp; 1) == 0) {
      return;
    }
  }
  uVar2 = s_Pressed_2_80390078._8_2_;
  uVar1 = s_Pressed_2_80390078._4_4_;
  *(undefined4 *)pressed_key = s_Pressed_2_80390078._0_4_;
  *(undefined4 *)(pressed_key + 4) = uVar1;
  *(undefined2 *)(pressed_key + 8) = uVar2;
  return;
}
</code></pre>
</details>
<h2><a class="header" href="#getting-the-flag" id="getting-the-flag">Getting the flag</a></h2>
<p>When tracing what gets printed onto the screen, we suspect heavily that the flag would be printed when the sequence of key presses are correct. We also suspect that the flag gets printed in the space of <code>No flag yet ...</code>. Tracking that ,), we see another usage of that variable, (refactored as <code>FLAG</code> , in one place which is &quot;sequence&quot; 9.</p>
<p>All we need to do is to move from sequence to sequence.</p>
<pre><code class="language-c">...
...
if (sequence == 9) {
        if ((key_code &amp; 0x800) != 0) {
          FLAG = (undefined4 *)&amp;local_a0; // &lt;- REACH HERE
          local_8e = local_5c._2_1_;
          local_90 = local_6c._0_1_;
        }
LAB_8003d8e4:
        if (sequence == 0) {
LAB_8003d8ec:
          sequence = 0;
          if ((key_code &amp; 8) != 0) {   // &lt;-- A PRESS
            sequence = 1;
            local_80 = (char)local_58;
            local_7e = local_78._1_1_ + ' ';
            local_81 = local_60._2_1_;
            local_a0 = (char)local_58 + -0x20;
            local_83 = local_70._0_1_;
          }
        }
      }
      else {
        if (sequence == 8) {
          if ((key_code &amp; 0x800) == 0) goto LAB_8003d8ec; // &lt;-- UP PRESS
          local_93 = local_58._2_1_;
          sequence = 9;
          local_98 = local_68._0_1_;
...
...

// Continue on and chain them up from sequence 0 to 9
</code></pre>
<p>After the quick trace, we see that we are supposed to press <code>&lt;A&gt;&lt;B&gt;&lt;RIGHT&gt;&lt;LEFT&gt;&lt;RIGHT&gt;&lt;LEFT&gt;&lt;DOWN&gt;&lt;DOWN&gt;&lt;UP&gt;&lt;UP&gt;</code></p>
<p>Trying that on the program and we flagged!</p>
<p><img src="img/serviceRevolutionFlag.png" alt="flag_service_revolution" /></p>
<h3><a class="header" href="#flag--alleswii_love_to_enter_great_flags" id="flag--alleswii_love_to_enter_great_flags">FLAG : ALLES{Wii_love_to_enter_great_flags}</a></h3>
<hr />

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../research/1_ASUSWRT_3_0_0_4_384_20308.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../writeups/angr/3_angr_post_1.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../research/1_ASUSWRT_3_0_0_4_384_20308.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../writeups/angr/3_angr_post_1.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        
        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:3000/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
